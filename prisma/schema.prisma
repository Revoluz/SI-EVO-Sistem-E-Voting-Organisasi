// 1. Konfigurasi
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// 2. Model Admin
model Admin {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
}

// 3. Model Voter (Terhubung dengan AVL Tree Logic)
model Voter {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  hasVoted  Boolean  @default(false)
  createdAt DateTime @default(now())

  votes     Vote[]
}

// 4. Model Sesi Pemilihan
model ElectionSession {
  id        Int      @id @default(autoincrement())
  title     String
  startTime DateTime
  endTime   DateTime
  status    String   @default("PREPARATION")

  candidates Candidate[]
  votes      Vote[]
}

// 5. Model Kandidat (Terhubung dengan Array Logic)
model Candidate {
  id              Int      @id @default(autoincrement())
  name            String
  vision          String?  @db.Text
  mission         String?  @db.Text
  photoUrl        String?
  
  electionSessionId Int
  electionSession   ElectionSession @relation(fields: [electionSessionId], references: [id])

  votes           Vote[]
}

// 6. Model Vote (Hasil akhir dari Queue Worker)
model Vote {
  id        Int      @id @default(autoincrement())
  votedAt   DateTime @default(now())

  voterId   Int
  voter     Voter @relation(fields: [voterId], references: [id])

  candidateId Int
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  electionSessionId Int
  electionSession   ElectionSession @relation(fields: [electionSessionId], references: [id])

  @@unique([voterId, electionSessionId])
}

// 7. Model AuditLog (Untuk menyimpan data Linked List secara permanen)
model AuditLog {
  id        Int      @id @default(autoincrement())
  action    String
  details   String   @db.Text
  timestamp DateTime @default(now())
}
