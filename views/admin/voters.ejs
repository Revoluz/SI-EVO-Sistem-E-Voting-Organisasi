<%- include('../partials/header') %>

<div class="admin-voters">
  <div class="voters-header">
    <h1>Voters Management</h1>
  </div>

  <div class="search-section">
    <div class="search-bar">
      <input 
        type="text" 
        id="searchInput" 
        placeholder="Search by name or email..."
        class="form-control"
      >
    </div>

    <div class="filter-section">
      <label>
        <input type="checkbox" id="filterVoted" value="voted">
        Show only voted
      </label>
      <label>
        <input type="checkbox" id="filterNotVoted" value="notVoted">
        Show only not voted
      </label>
      <button class="btn btn-secondary" onclick="clearFilters()">Clear Filters</button>
    </div>
  </div>

  <div class="table-section">
    <table class="voters-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Email</th>
          <th>Status</th>
          <th>Joined</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="votersTableBody">
        <% if (typeof voters !== 'undefined' && voters && voters.length > 0) { %>
          <% voters.forEach((voter, index) => { %>
            <tr class="voter-row" data-voter-id="<%= voter.id %>">
              <td><%= index + 1 %></td>
              <td><%= voter.name %></td>
              <td><%= voter.email %></td>
              <td>
                <span class="badge <%= voter.hasVoted ? 'badge-success' : 'badge-warning' %>">
                  <%= voter.hasVoted ? '✓ Voted' : '⊘ Not Voted' %>
                </span>
              </td>
              <td><%= new Date(voter.createdAt).toLocaleDateString() %></td>
              <td>
                <button class="btn btn-small btn-info" onclick="viewVoter('<%= voter.id %>')">View</button>
              </td>
            </tr>
          <% }); %>
        <% } else { %>
          <tr>
            <td colspan="6" class="text-center">No voters found</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
      <% for (let i = 1; i <= totalPages; i++) { %>
        <a href="?page=<%= i %>" class="btn btn-small <%= i === currentPage ? 'active' : '' %>">
          <%= i %>
        </a>
      <% } %>
    <% } %>
  </div>
</div>

<script>
function clearFilters() {
  document.getElementById('searchInput').value = '';
  document.getElementById('filterVoted').checked = false;
  document.getElementById('filterNotVoted').checked = false;
  filterTable();
}

function filterTable() {
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  const showVoted = document.getElementById('filterVoted').checked;
  const showNotVoted = document.getElementById('filterNotVoted').checked;
  
  document.querySelectorAll('.voter-row').forEach(row => {
    const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
    const email = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
    const hasVoted = row.querySelector('td:nth-child(4)').textContent.includes('Voted');
    
    let show = true;
    
    // Search filter
    if (searchTerm && !name.includes(searchTerm) && !email.includes(searchTerm)) {
      show = false;
    }
    
    // Vote status filter
    if ((showVoted || showNotVoted) && (
      (showVoted && !hasVoted) || (showNotVoted && hasVoted)
    )) {
      show = false;
    }
    
    row.style.display = show ? '' : 'none';
  });
}

function viewVoter(voterId) {
  alert('View voter ' + voterId + ' - To be implemented');
}

// Event listeners for filters
document.getElementById('searchInput').addEventListener('keyup', filterTable);
document.getElementById('filterVoted').addEventListener('change', filterTable);
document.getElementById('filterNotVoted').addEventListener('change', filterTable);
</script>

<%- include('../partials/footer') %>
